pr:
  autoCancel: true

# GCC
stages:
- stage: GCC
  dependsOn: []
  variables:
  - name: CC
    value: gcc
  - name: CXX
    value: g++
  pool:
    vmImage: 'ubuntu-latest'
  jobs:
  - job:
    displayName: Validate GCC latest
    container:
      image: sloppyjaconda/gsl_validation:gcc-10
    strategy:
      matrix:
        14_debug:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Debug'
        14_release:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Release'
        17_debug:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Debug'
        17_release:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Release'
    continueOnError: false
    steps:
    - template: ./pipelines/steps.yml

  - job:
    displayName: Validate GCC Previous
    container:
      image: sloppyjaconda/gsl_validation:gcc-9
    strategy:
      matrix:
        14_debug:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Debug'
        14_release:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Release'
        17_debug:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Debug'
        17_release:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Release'
    continueOnError: false
    steps:
    - template: ./pipelines/steps.yml

# Clang
- stage: Clang
  dependsOn: []
  variables:
  - name: CC
    value: clang
  - name: CXX
    value: clang++
  pool:
    vmImage: ubuntu-latest
  jobs:
  - job:
    displayName: Validate Clang latest
    container:
      image: sloppyjaconda/gsl_validation:clang-11
    strategy:
      matrix:
        14_debug:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Debug'
        14_release:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Release'
        17_debug:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Debug'
        17_release:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Release'
    continueOnError: false
    steps:
    - template: ./pipelines/steps.yml

  - job:
    displayName: Validate Clang previous
    container:
      image: sloppyjaconda/gsl_validation:clang-10
    strategy:
      matrix:
        14_debug:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Debug'
        14_release:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Release'
        17_debug:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Debug'
        17_release:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Release'
    continueOnError: false
    steps:
    - template: ./pipelines/steps.yml

# MSVC
- stage: MSVC
  dependsOn: []
  jobs:
  - job:
    displayName: Validate MSVC latest
    pool:
      vmImage: windows-latest
    strategy:
      matrix:
        14_debug:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Debug'
        14_release:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Release'
        17_debug:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Debug'
        17_release:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Release'
    steps:
    - template: ./pipelines/steps.yml

  - job:
    displayName: Validate MSVC previous
    pool:
      vmImage: vs2017-win2016
    strategy:
      matrix:
        14_debug:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Debug'
        14_release:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Release'
        17_debug:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Debug'
        17_release:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Release'
    steps:
    - template: ./pipelines/steps.yml

# Apple-Clang
- stage: Apple_Clang
  dependsOn: []
  jobs:
  - job:
    displayName: Validate Apple-Clang latest
    pool:
      vmImage: macos-latest
    strategy:
      matrix:
        14_debug:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Debug'
        14_release:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Release'
        17_debug:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Debug'
        17_release:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Release'
    steps:
    - template: ./pipelines/steps.yml

  - job:
    displayName: Validate Apple-Clang previous
    pool:
      vmImage: macOS-10.14
    strategy:
      matrix:
        14_debug:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Debug'
        14_release:
          GSL_CXX_STANDARD: '14'
          BUILD_TYPE: 'Release'
        17_debug:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Debug'
        17_release:
          GSL_CXX_STANDARD: '17'
          BUILD_TYPE: 'Release'
    steps:
    - template: ./pipelines/steps.yml
